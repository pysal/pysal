<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pysal.explore.pointpats.process &#8212; pysal v2.1.0 Manual</title>
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/pysal-styles.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../../_static/pysal_favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html">
          pysal</a>
        <span class="navbar-text navbar-version pull-left"><b>2.1.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../installation.html">Installation</a></li>
                <li><a href="../../../../api.html">API</a></li>
                <li><a href="../../../../references.html">References</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#installing-with-conda">Installing with conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#installing-with-pip">Installing with pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#installing-the-development-version">Installing the development version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../installation.html#installing-versions-supporting-python-2">Installing versions supporting Python 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../api.html#pysal-lib-pysal-core"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysal.lib</span></code>: PySAL Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api.html#pysal-explore-exploratory-spatial-data-analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysal.explore</span></code>: Exploratory spatial data analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api.html#pysal-viz-geovisualization"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysal.viz</span></code>: Geovisualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../api.html#pysal-model-linear-models-for-spatial-data-analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysal.model</span></code>: Linear models for spatial data analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../references.html">References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for pysal.explore.pointpats.process</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simulation of planar point processes</span>

<span class="sd">TODO</span>

<span class="sd">- inhibition process(es)</span>
<span class="sd">- optimize draws for complex windows</span>
<span class="sd">- documentation</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Serge Rey sjsrey@gmail.com&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PointProcess&#39;</span><span class="p">,</span> <span class="s1">&#39;PoissonPointProcess&#39;</span><span class="p">,</span> <span class="s1">&#39;PoissonClusterPointProcess&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pysal.lib</span> <span class="k">as</span> <span class="nn">ps</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="k">import</span> <span class="n">poisson</span>
<span class="kn">from</span> <span class="nn">.pointpattern</span> <span class="k">import</span> <span class="n">PointPattern</span> <span class="k">as</span> <span class="n">PP</span>


<span class="k">def</span> <span class="nf">runif_in_circle</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">burn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate n points within a circle of given radius.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n             : int</span>
<span class="sd">                    Number of points.</span>
<span class="sd">    radius        : float</span>
<span class="sd">                    Radius of the circle.</span>
<span class="sd">    center        : tuple</span>
<span class="sd">                    Coordinates of the center.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">                  : array</span>
<span class="sd">                    (n+1, 2), coordinates of generated points as well as</span>
<span class="sd">                    the center.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">good</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">radius</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span>
    <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">burn</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">burn</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">r2</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))[</span><span class="n">ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">candidates</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">need</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span>
        <span class="k">if</span> <span class="n">nc</span> <span class="o">&gt;</span> <span class="n">need</span><span class="p">:</span>  <span class="c1"># more than we need</span>
            <span class="n">good</span><span class="p">[</span><span class="n">c</span><span class="p">:]</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[:</span><span class="n">need</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># use them all and keep going</span>
            <span class="n">good</span><span class="p">[</span><span class="n">c</span><span class="p">:</span><span class="n">c</span><span class="o">+</span><span class="n">nc</span><span class="p">]</span> <span class="o">=</span> <span class="n">candidates</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="n">nc</span>
        <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Iterations: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">good</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>


<div class="viewcode-block" id="PointProcess"><a class="viewcode-back" href="../../../../generated/pysal.explore.pointpats.PointProcess.html#pysal.explore.pointpats.PointProcess">[docs]</a><span class="k">class</span> <span class="nc">PointProcess</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Point Process base class.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window        : :py:class:`~.window.Window`</span>
<span class="sd">                    Bounding geometric object to contain point process</span>
<span class="sd">                    realizations.</span>
<span class="sd">    n             : int</span>
<span class="sd">                    Size of each realization.</span>
<span class="sd">    samples       : list</span>
<span class="sd">                    Number of realizations.</span>
<span class="sd">    asPP          : bool</span>
<span class="sd">                    Control the data type of value in the &quot;realizations&quot;</span>
<span class="sd">                    dictionary. If True, the data type is point</span>
<span class="sd">                    pattern as defined in pointpattern.py; if False,</span>
<span class="sd">                    the data type is an two-dimensional array.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    realizations  : dictionary</span>
<span class="sd">                    The key is the index of each realization, and the</span>
<span class="sd">                    value is simulated event points for each</span>
<span class="sd">                    realization. The data type of the value is</span>
<span class="sd">                    controlled by the parameter &quot;asPP&quot;.</span>
<span class="sd">    parameters    : dictionary</span>
<span class="sd">                    Dictionary of a dictionary.</span>
<span class="sd">                    The key is the index of each realization, and the</span>
<span class="sd">                    value is a dictionary with the key &#39;n&#39; and the</span>
<span class="sd">                    value size of each realization.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PointProcess.__init__"><a class="viewcode-back" href="../../../../generated/pysal.explore.pointpats.PointProcess.html#pysal.explore.pointpats.PointProcess.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">asPP</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">PointProcess</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">realizations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">realizations</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">sample</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">asPP</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">realizations</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realizations</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">realizations</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">PP</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a series of point coordinates within the given window.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameter  : dictionary</span>
<span class="sd">                     Key: &#39;n&#39;.</span>
<span class="sd">                     Value: size of the realization.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">                   : array</span>
<span class="sd">                     A series of point coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">parameter</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="n">pnts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realize</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">pnts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ps</span><span class="o">.</span><span class="n">cg</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">Point</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pnts</span><span class="p">]</span>
            <span class="n">pins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">filter_contained</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span>
            <span class="n">sample</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pins</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">[:</span><span class="n">n</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="PoissonPointProcess"><a class="viewcode-back" href="../../../../generated/pysal.explore.pointpats.PoissonPointProcess.html#pysal.explore.pointpats.PoissonPointProcess">[docs]</a><span class="k">class</span> <span class="nc">PoissonPointProcess</span><span class="p">(</span><span class="n">PointProcess</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Poisson point process including :math:`N`-conditioned CSR process and</span>
<span class="sd">    :math:`\lambda`-conditioned CSR process.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window        : :py:class:`~.window.Window`</span>
<span class="sd">                    Bounding geometric object to contain point process</span>
<span class="sd">                    realizations.</span>
<span class="sd">    n             : int</span>
<span class="sd">                    Size of each realization.</span>
<span class="sd">    samples       : list</span>
<span class="sd">                    Number of realizations.</span>
<span class="sd">    conditioning  : bool</span>
<span class="sd">                    If True, use the :math:`\lambda`-conditioned CSR process,</span>
<span class="sd">                    number of events would vary across realizations;</span>
<span class="sd">                    if False, use the :math:`N`-conditioned CSR process.</span>
<span class="sd">    asPP          : bool</span>
<span class="sd">                    Control the data type of value in the &quot;realizations&quot;</span>
<span class="sd">                    dictionary. If True, the data type is point</span>
<span class="sd">                    pattern as defined in pointpattern.py; if False,</span>
<span class="sd">                    the data type is an two-dimensional array.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    realizations  : dictionary</span>
<span class="sd">                    The key is the index of each realization, and the</span>
<span class="sd">                    value is simulated event points for each</span>
<span class="sd">                    realization. The data type of the value is</span>
<span class="sd">                    controlled by the parameter &quot;asPP&quot;.</span>
<span class="sd">    parameters    : dictionary</span>
<span class="sd">                    Dictionary of a dictionary.</span>
<span class="sd">                    The key is the index of each realization, and the</span>
<span class="sd">                    value is a dictionary with the key &#39;n&#39; and the</span>
<span class="sd">                    value:</span>
<span class="sd">                    1. always equal to the parameter n in the case of</span>
<span class="sd">                    N-conditioned process.</span>
<span class="sd">                    For example, {0:{&#39;n&#39;:100},1:{&#39;n&#39;:100},2:{&#39;n&#39;:100}}</span>
<span class="sd">                    2. randomly generated from a Possion process in</span>
<span class="sd">                    the case of lambda-conditioned process.</span>
<span class="sd">                    For example, {0:{&#39;n&#39;:97},1:{&#39;n&#39;:100},2:{&#39;n&#39;:98}}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pysal.lib as ps</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from pointpats import Window</span>
<span class="sd">    &gt;&gt;&gt; from pysal.lib.cg import shapely_ext</span>

<span class="sd">    Open the virginia polygon shapefile</span>

<span class="sd">    &gt;&gt;&gt; va = ps.io.open(ps.examples.get_path(&quot;virginia.shp&quot;))</span>

<span class="sd">    Create the exterior polygons for VA from the union of the county shapes</span>

<span class="sd">    &gt;&gt;&gt; polys = [shp for shp in va]</span>
<span class="sd">    &gt;&gt;&gt; state = shapely_ext.cascaded_union(polys)</span>

<span class="sd">    Create window from virginia state boundary</span>

<span class="sd">    &gt;&gt;&gt; window = Window(state.parts)</span>

<span class="sd">    1. Simulate a :math:`N`-conditioned csr process in the same window (10</span>
<span class="sd">    points, 2 realizations)</span>

<span class="sd">    &gt;&gt;&gt; np.random.seed(5)</span>
<span class="sd">    &gt;&gt;&gt; samples1 = PoissonPointProcess(window, 10, 2, conditioning=False, asPP=False)</span>
<span class="sd">    &gt;&gt;&gt; samples1.realizations[0] # the first realized event points</span>
<span class="sd">    array([[-81.80326547,  36.77687577],</span>
<span class="sd">           [-78.5166233 ,  37.34055832],</span>
<span class="sd">           [-77.21660795,  37.7491503 ],</span>
<span class="sd">           [-79.30361037,  37.40467853],</span>
<span class="sd">           [-78.61625258,  36.61234487],</span>
<span class="sd">           [-81.43369537,  37.13784646],</span>
<span class="sd">           [-80.91302108,  36.60834063],</span>
<span class="sd">           [-76.90806444,  37.95525903],</span>
<span class="sd">           [-76.33475868,  36.62635347],</span>
<span class="sd">           [-79.71621808,  37.27396618]])</span>

<span class="sd">    2. Simulate a :math:`\lambda`-conditioned csr process in the same window (10</span>
<span class="sd">    points, 2 realizations)</span>

<span class="sd">    &gt;&gt;&gt; np.random.seed(5)</span>
<span class="sd">    &gt;&gt;&gt; samples2 = PoissonPointProcess(window, 10, 2, conditioning=True, asPP=True)</span>
<span class="sd">    &gt;&gt;&gt; samples2.realizations[0].n # the size of first realized point pattern</span>
<span class="sd">    10</span>
<span class="sd">    &gt;&gt;&gt; samples2.realizations[1].n # the size of second realized point pattern</span>
<span class="sd">    13</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PoissonPointProcess.__init__"><a class="viewcode-back" href="../../../../generated/pysal.explore.pointpats.PoissonPointProcess.html#pysal.explore.pointpats.PoissonPointProcess.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">conditioning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">asPP</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditioning</span> <span class="o">=</span> <span class="n">conditioning</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PoissonPointProcess</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">asPP</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the number of events for each realization. If</span>
<span class="sd">        &quot;conditioning&quot; is False, all the event numbers are the same;</span>
<span class="sd">        if it is True, the event number is a random variable</span>
<span class="sd">        following a Poisson distribution.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditioning</span><span class="p">:</span>
            <span class="n">lambdas</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lambdas</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">l</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate n points which are randomly and independently</span>
<span class="sd">        distributed in the minimum bounding box of &quot;window&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n             : int</span>
<span class="sd">                        Number of point events.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">                      : array</span>
<span class="sd">                        (n,2), n point coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">bbox</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span></div>


<div class="viewcode-block" id="PoissonClusterPointProcess"><a class="viewcode-back" href="../../../../generated/pysal.explore.pointpats.PoissonClusterPointProcess.html#pysal.explore.pointpats.PoissonClusterPointProcess">[docs]</a><span class="k">class</span> <span class="nc">PoissonClusterPointProcess</span><span class="p">(</span><span class="n">PointProcess</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Poisson cluster point process (Neyman Scott).</span>
<span class="sd">    Two stages: </span>
<span class="sd">    1. parent CSR process: :math:`N`-conditioned or </span>
<span class="sd">    :math:`\lambda`-conditioned. If parent events follow a </span>
<span class="sd">    :math:`\lambda`-conditioned CSR process, </span>
<span class="sd">    the number of parent events varies across realizations.</span>
<span class="sd">    2. child process: fixed number of points in circle centered </span>
<span class="sd">    on each parent.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window        : :py:class:`~.window.Window`</span>
<span class="sd">                    Bounding geometric object to contain point process</span>
<span class="sd">                    realizations.</span>
<span class="sd">    n             : int</span>
<span class="sd">                    Size of each realization.</span>
<span class="sd">    parents       : int</span>
<span class="sd">                    Number of parents.</span>
<span class="sd">    radius        : float</span>
<span class="sd">                    Radius of the circle centered on each parent.</span>
<span class="sd">    samples       : list</span>
<span class="sd">                    Number of realizations.</span>
<span class="sd">    asPP          : bool</span>
<span class="sd">                    Control the data type of value in the &quot;realizations&quot;</span>
<span class="sd">                    dictionary. If True, the data type is point</span>
<span class="sd">                    pattern as defined in pointpattern.py; if False,</span>
<span class="sd">                    the data type is an two-dimensional array.</span>
<span class="sd">    conditioning  : bool</span>
<span class="sd">                    If True, use the :math:`lambda`-conditioned CSR process</span>
<span class="sd">                    for parent events, leading to varied number of</span>
<span class="sd">                    parent events across realizations;</span>
<span class="sd">                    if False, use the :math:`N`-conditioned CSR process.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    children      : int</span>
<span class="sd">                    Number of childrens centered on each parent. Can</span>
<span class="sd">                    be considered as local intensity.</span>
<span class="sd">    num_parents   : dictionary</span>
<span class="sd">                    The key is the index of each realization. The</span>
<span class="sd">                    value is the number of parent events for each</span>
<span class="sd">                    realization.</span>
<span class="sd">    realizations  : dictionary</span>
<span class="sd">                    The key is the index of each realization, and the</span>
<span class="sd">                    value is simulated event points for each</span>
<span class="sd">                    realization. The data type of the value is</span>
<span class="sd">                    controlled by the parameter &quot;asPP&quot;.</span>
<span class="sd">    parameters    : dictionary</span>
<span class="sd">                    Dictionary of a dictionary.</span>
<span class="sd">                    The key is the index of each realization, and the</span>
<span class="sd">                    value is a dictionary with the key &#39;n&#39; and the</span>
<span class="sd">                    value always equal to the parameter n in the</span>
<span class="sd">                    case of</span>
<span class="sd">                    N-conditioned process.</span>
<span class="sd">                    For example, {0:{&#39;n&#39;:100},1:{&#39;n&#39;:100},2:{&#39;n&#39;:100}}</span>
<span class="sd">                    2. randomly generated from a Possion process in</span>
<span class="sd">                    the case of lambda-conditioned process.</span>
<span class="sd">                    For example, {0:{&#39;n&#39;:97},1:{&#39;n&#39;:100},2:{&#39;n&#39;:98}}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import pysal.lib as ps</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from pointpats import Window</span>
<span class="sd">    &gt;&gt;&gt; from pysal.lib.cg import shapely_ext</span>

<span class="sd">    Open the virginia polygon shapefile</span>

<span class="sd">    &gt;&gt;&gt; va = ps.io.open(ps.examples.get_path(&quot;virginia.shp&quot;))</span>

<span class="sd">    Create the exterior polygons for VA from the union of the county shapes</span>

<span class="sd">    &gt;&gt;&gt; polys = [shp for shp in va]</span>
<span class="sd">    &gt;&gt;&gt; state = shapely_ext.cascaded_union(polys)</span>

<span class="sd">    Create window from virginia state boundary</span>

<span class="sd">    &gt;&gt;&gt; window = Window(state.parts)</span>

<span class="sd">    1. Simulate a Poisson cluster process of size 200 with 10 parents</span>
<span class="sd">    and 20 children within 0.5 units of each parent</span>
<span class="sd">    (parent events:  :math:`N`-conditioned CSR)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; np.random.seed(10)</span>
<span class="sd">    &gt;&gt;&gt; samples1 = PoissonClusterPointProcess(window, 200, 10, 0.5, 1, asPP=True, conditioning=False)</span>
<span class="sd">    &gt;&gt;&gt; samples1.parameters # number of events for the realization</span>
<span class="sd">    {0: {&#39;n&#39;: 200}}</span>
<span class="sd">    &gt;&gt;&gt; samples1.num_parents #number of parent events for each realization</span>
<span class="sd">    {0: 10}</span>
<span class="sd">    &gt;&gt;&gt; samples1.children # number of children events centered on each parent event</span>
<span class="sd">    20</span>

<span class="sd">    2. Simulate a Poisson cluster process of size 200 with 10 parents</span>
<span class="sd">    and 20 children within 0.5 units of each parent</span>
<span class="sd">    (parent events:  :math:`\lambda`-conditioned CSR)</span>

<span class="sd">    &gt;&gt;&gt; np.random.seed(10)</span>
<span class="sd">    &gt;&gt;&gt; samples2 = PoissonClusterPointProcess(window, 200, 10, 0.5, 1, asPP=True, conditioning=True)</span>
<span class="sd">    &gt;&gt;&gt; samples2.parameters # number of events for the realization might not be equal to 200</span>
<span class="sd">    {0: {&#39;n&#39;: 260}}</span>
<span class="sd">    &gt;&gt;&gt; samples2.num_parents #number of parent events for each realization</span>
<span class="sd">    {0: 13}</span>
<span class="sd">    &gt;&gt;&gt; samples2.children # number of children events centered on each parent event</span>
<span class="sd">    20</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PoissonClusterPointProcess.__init__"><a class="viewcode-back" href="../../../../generated/pysal.explore.pointpats.PoissonClusterPointProcess.html#pysal.explore.pointpats.PoissonClusterPointProcess.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">parents</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">asPP</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">conditioning</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conditioning</span> <span class="o">=</span> <span class="n">conditioning</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parents</span> <span class="o">=</span> <span class="n">parents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">parents</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep</span> <span class="o">=</span> <span class="n">keep</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PoissonClusterPointProcess</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span>
                                                         <span class="n">asPP</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the number of events for each realization. If</span>
<span class="sd">        &quot;conditioning&quot; is False, all the event numbers are the same;</span>
<span class="sd">        if it is True, the number of parents is a random variable</span>
<span class="sd">        following a Poisson distribution, resulting in varied number</span>
<span class="sd">        of events.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_parents</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditioning</span><span class="p">:</span>
            <span class="n">lambdas</span> <span class="o">=</span> <span class="n">poisson</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lambdas</span><span class="p">):</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">num</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">samples</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_parents</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parents</span>

    <span class="k">def</span> <span class="nf">realize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate n points which are distributed in a clustered</span>
<span class="sd">        fashion in the minimum bounding box of &quot;window&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n             : int</span>
<span class="sd">                        Number of point events.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res           : array</span>
<span class="sd">                        (n,2), n point coordinates.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">bbox</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
        <span class="c1"># get parent points</span>
        <span class="n">pxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">pys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">cents</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pxs</span><span class="p">,</span> <span class="n">pys</span><span class="p">))</span>
        <span class="c1"># generate children points</span>
        <span class="n">pnts</span> <span class="o">=</span> <span class="p">[</span><span class="n">runif_in_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span> <span class="k">for</span> <span class="n">center</span> <span class="ow">in</span> <span class="n">cents</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pnts</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cents</span><span class="p">),</span> <span class="n">res</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># so we don&#39;t truncate in a biased fashion</span>
        <span class="k">return</span> <span class="n">res</span></div>
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright 2018-, pysal developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>